# Telco Churn Prediction : Top-K + Profit Optimization

Проект прогнозирования оттока клиентов (churn) на табличных данных.  
Модель используется не только как классификатор, но и как скоринг для ранжирования клиентов, чтобы:

- выбирать Top-K% клиентов для удержания (если бюджет ограничен);
- подбирать оптимальный порог по прибыли, а не по стандартному 0.5.

---

## Основная идея

В реальном бизнесе обычно нельзя работать со всеми клиентами сразу (например, обзвон, скидки, персональные предложения).  
Поэтому важны не только ROC-AUC и PR-AUC, но и:

- сколько churn-клиентов мы поймаем, если обработаем только Top-K%;
- какой порог дает максимальную ожидаемую прибыль.

---

## Структура проекта

- `src/train.py` — обучение модели, расчет метрик, построение графиков
- `src/data.py` — загрузка данных
- `src/features.py` — обработка признаков и подготовка пайплайна
- `src/metrics.py` — расчет метрик, Top-K качества и Profit Curve
- `reports/metrics.json` — итоговые метрики модели
- `reports/classification_report.txt` — отчет sklearn по классам
- `reports/pr_curve.png` — PR-кривая
- `reports/roc_curve.png` — ROC-кривая
- `reports/profit_curve.png` — кривая ожидаемой прибыли

---

## Данные

Используется датасет Telco Customer Churn.

Файл:

`data/raw/telco_churn.csv`

Целевая переменная:
- `Churn = 1` — клиент ушел
- `Churn = 0` — клиент остался

---

## Как запустить

### 1) Установка зависимостей

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 2) Обучение и оценка

```bash
python -c "from src.train import main; main()"
```

После запуска будут созданы:
- `reports/metrics.json`
- `reports/classification_report.txt`
- `reports/pr_curve.png`, `reports/roc_curve.png`, `reports/profit_curve.png`

---

## Модель

Используется воспроизводимый sklearn pipeline:
- обработка числовых признаков
- обработка категориальных признаков
- классификатор (baseline модель задается в `src/train.py`)

---

## Метрики

### 1) Классические метрики качества

- ROC-AUC
- PR-AUC
- LogLoss
- Brier score (качество вероятностей)

### 2) Качество в формате Top-K%

Показывает, как модель работает в реальном retention-сценарии:
- Recall в Top-K% - какую долю всех churn-клиентов мы найдем, если обработаем только Top-K% базы
- Precision в Top-K% - насколько «чистый» список риска (доля настоящих churn среди выбранных)

Пример интерпретации:

«Recall в Top-20% = 0.49 означает: если удерживать только 20% клиентов с самым высоким скором, мы поймаем около 49% всех оттоков.»

---

## Profit Curve (порог по прибыли)

Обычно порог 0.5 для churn не оптимален.  
В этом проекте подбирается порог, который максимизирует ожидаемую прибыль:
- учитываются стоимость воздействия (например, скидка/контакт)
- учитывается ожидаемая выгода от предотвращения ухода

Результат отображается на графике `reports/profit_curve.png`.

---

## Графики

После запуска доступны:
- `reports/pr_curve.png` — Precision-Recall кривая
- `reports/roc_curve.png` — ROC кривая
- `reports/profit_curve.png` — зависимость прибыли от порога

---

## Вывод

Проект делает churn-модель:
- дает скоринг клиентов по риску ухода
- позволяет работать в условиях ограниченного бюджета через Top-K подход
- выбирает порог по максимальной ожидаемой прибыли

---
